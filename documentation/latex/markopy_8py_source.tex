\hypertarget{markopy_8py_source}{}\doxysection{markopy.\+py}
\label{markopy_8py_source}\index{markopy.py@{markopy.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00001}\mbox{\hyperlink{namespacemarkopy}{00001}} \textcolor{stringliteral}{""" @package markopy}}
\DoxyCodeLine{00002 \textcolor{stringliteral}{ @file markopy.py}}
\DoxyCodeLine{00003 \textcolor{stringliteral}{ @namespace Python::Markopy}}
\DoxyCodeLine{00004 \textcolor{stringliteral}{ @brief Command line }}
\DoxyCodeLine{00005 \textcolor{stringliteral}{ @authors Ata Hakçıl}}
\DoxyCodeLine{00006 \textcolor{stringliteral}{"""}}
\DoxyCodeLine{00007 }
\DoxyCodeLine{00008 \textcolor{keyword}{import} markopy}
\DoxyCodeLine{00009 \textcolor{keyword}{import} argparse}
\DoxyCodeLine{00010 \textcolor{keyword}{import} allogate \textcolor{keyword}{as} logging}
\DoxyCodeLine{00011 \textcolor{keyword}{import} re}
\DoxyCodeLine{00012 \textcolor{keyword}{import} os}
\DoxyCodeLine{00013 }
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00014}\mbox{\hyperlink{namespacemarkopy_ad5187b752577f4de390b183b9c31ba33}{00014}} parser = argparse.ArgumentParser(description=\textcolor{stringliteral}{"Python wrapper for MarkovPasswords."},}
\DoxyCodeLine{00015 epilog=f\textcolor{stringliteral}{"""Sample runs:}}
\DoxyCodeLine{00016 \textcolor{stringliteral}{\{\_\_file\_\_\} train untrained.mdl -\/d dataset.dat -\/s "\(\backslash\)\(\backslash\)t" -\/o trained.mdl}}
\DoxyCodeLine{00017 \textcolor{stringliteral}{    Import untrained.mdl, train it with dataset.dat which has tab delimited data, output resulting model to trained.mdl\(\backslash\)n}}
\DoxyCodeLine{00018 \textcolor{stringliteral}{}}
\DoxyCodeLine{00019 \textcolor{stringliteral}{\{\_\_file\_\_\} generate trained.mdl -\/n 500 -\/w output.txt}}
\DoxyCodeLine{00020 \textcolor{stringliteral}{    Import trained.mdl, and generate 500 lines to output.txt}}
\DoxyCodeLine{00021 \textcolor{stringliteral}{}}
\DoxyCodeLine{00022 \textcolor{stringliteral}{\{\_\_file\_\_\} combine untrained.mdl -\/d dataset.dat -\/s "\(\backslash\)\(\backslash\)t" -\/n 500 -\/w output.txt}}
\DoxyCodeLine{00023 \textcolor{stringliteral}{    Train and immediately generate 500 lines to output.txt. Do not export trained model.}}
\DoxyCodeLine{00024 \textcolor{stringliteral}{}}
\DoxyCodeLine{00025 \textcolor{stringliteral}{\{\_\_file\_\_\} combine untrained.mdl -\/d dataset.dat -\/s "\(\backslash\)\(\backslash\)t" -\/n 500 -\/w output.txt -\/o trained.mdl}}
\DoxyCodeLine{00026 \textcolor{stringliteral}{    Train and immediately generate 500 lines to output.txt. Export trained model.}}
\DoxyCodeLine{00027 \textcolor{stringliteral}{"""}, formatter\_class=argparse.RawTextHelpFormatter)}
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00028}\mbox{\hyperlink{namespacemarkopy_af0bdb445023da76e7f85a8d9499759cc}{00028}} parser.add\_argument(\textcolor{stringliteral}{"mode"},                             help=\textcolor{stringliteral}{"Operation mode, supported modes: \(\backslash\)"generate\(\backslash\)", \(\backslash\)"train\(\backslash\)" and \(\backslash\)"combine\(\backslash\)"."})}
\DoxyCodeLine{00029 parser.add\_argument(\textcolor{stringliteral}{"input"},                            help=\textcolor{stringliteral}{"Input model file. This model will be imported before starting operation."})}
\DoxyCodeLine{00030 parser.add\_argument(\textcolor{stringliteral}{"-\/o"}, \textcolor{stringliteral}{"-\/-\/output"},                   help=\textcolor{stringliteral}{"Output model file. This model will be exported when done. Will be ignored for generation mode."})}
\DoxyCodeLine{00031 parser.add\_argument(\textcolor{stringliteral}{"-\/d"}, \textcolor{stringliteral}{"-\/-\/dataset"},                  help=\textcolor{stringliteral}{"Dataset file to read input from for training. Will be ignored for generation mode."})}
\DoxyCodeLine{00032 parser.add\_argument(\textcolor{stringliteral}{"-\/s"}, \textcolor{stringliteral}{"-\/-\/seperator"},                help=\textcolor{stringliteral}{"Seperator character to use with training data.(character between occurrence and value)"})}
\DoxyCodeLine{00033 parser.add\_argument(\textcolor{stringliteral}{"-\/w"}, \textcolor{stringliteral}{"-\/-\/wordlist"},                 help=\textcolor{stringliteral}{"Wordlist file path to export generation results to. Will be ignored for training mode"})}
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00034}\mbox{\hyperlink{namespacemarkopy_abb9bff08b408153eb76a826d5da1f58d}{00034}} parser.add\_argument(\textcolor{stringliteral}{"-\/-\/min"}, default=6,                 help=\textcolor{stringliteral}{"Minimum length that is allowed during generation"})}
\DoxyCodeLine{00035 parser.add\_argument(\textcolor{stringliteral}{"-\/-\/max"}, default=12,                help=\textcolor{stringliteral}{"Maximum length that is allowed during generation"})}
\DoxyCodeLine{00036 parser.add\_argument(\textcolor{stringliteral}{"-\/n"}, \textcolor{stringliteral}{"-\/-\/count"},                    help=\textcolor{stringliteral}{"Number of lines to generate. Ignored in training mode."})}
\DoxyCodeLine{00037 parser.add\_argument(\textcolor{stringliteral}{"-\/t"}, \textcolor{stringliteral}{"-\/-\/threads"},default=10,       help=\textcolor{stringliteral}{"Number of lines to generate. Ignored in training mode."})}
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00038}\mbox{\hyperlink{namespacemarkopy_a0060c95c4eab77bd5bd97e726184eede}{00038}} parser.add\_argument(\textcolor{stringliteral}{"-\/v"}, \textcolor{stringliteral}{"-\/-\/verbosity"},action=\textcolor{stringliteral}{"count"}, help=\textcolor{stringliteral}{"Output verbosity."})}
\DoxyCodeLine{00039 parser.add\_argument(\textcolor{stringliteral}{"-\/b"}, \textcolor{stringliteral}{"-\/-\/bulk"},action=\textcolor{stringliteral}{"store\_true"}, help=\textcolor{stringliteral}{"Bulk generate or bulk train every corpus/model in the folder."})}
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00040}\mbox{\hyperlink{namespacemarkopy_ae63e871240a7b671be13b268efdba52f}{00040}} args = parser.parse\_args() }
\DoxyCodeLine{00041 }
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044 }
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00045}\mbox{\hyperlink{namespacemarkopy_a2339398e991abb1c095994eb07f12af6}{00045}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemarkopy_a2339398e991abb1c095994eb07f12af6}{cli\_init}}(input\_model : str):}
\DoxyCodeLine{00046     \textcolor{stringliteral}{""" Initialize the model for CLI interation }}
\DoxyCodeLine{00047 \textcolor{stringliteral}{        @param input\_model Model filename}}
\DoxyCodeLine{00048 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{00049     logging.VERBOSITY = 0}
\DoxyCodeLine{00050     \textcolor{keywordflow}{if} args.verbosity:}
\DoxyCodeLine{00051         logging.VERBOSITY = args.verbosity}
\DoxyCodeLine{00052         logging.pprint(f\textcolor{stringliteral}{"Verbosity set to \{args.verbosity\}."}, 2)}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054     logging.pprint(\textcolor{stringliteral}{"Initializing model."}, 1)}
\DoxyCodeLine{00055     model = markopy.ModelMatrix()}
\DoxyCodeLine{00056     logging.pprint(\textcolor{stringliteral}{"Model initialized."}, 2)}
\DoxyCodeLine{00057 }
\DoxyCodeLine{00058     logging.pprint(\textcolor{stringliteral}{"Importing model file."}, 1)}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060     if(\textcolor{keywordflow}{not} os.path.isfile(input\_model)):}
\DoxyCodeLine{00061         logging.pprint(f\textcolor{stringliteral}{"Model file at \{input\_model\} not found. Check the file path, or working directory"})}
\DoxyCodeLine{00062         exit(1)}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064     model.Import(input\_model)}
\DoxyCodeLine{00065     logging.pprint(\textcolor{stringliteral}{"Model imported successfully."}, 2)}
\DoxyCodeLine{00066     \textcolor{keywordflow}{return} model}
\DoxyCodeLine{00067 }
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00068}\mbox{\hyperlink{namespacemarkopy_ab5b767749715ed49aacf40c4b839f3a9}{00068}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemarkopy_ab5b767749715ed49aacf40c4b839f3a9}{cli\_train}}(model : markopy.ModelMatrix, dataset : str, seperator : str, output : str, output\_forced : bool=\textcolor{keyword}{False}, bulk : bool=\textcolor{keyword}{False}):}
\DoxyCodeLine{00069     \textcolor{stringliteral}{""" Train a model via CLI parameters }}
\DoxyCodeLine{00070 \textcolor{stringliteral}{        @param model Model instance}}
\DoxyCodeLine{00071 \textcolor{stringliteral}{        @param dataset filename for the dataset}}
\DoxyCodeLine{00072 \textcolor{stringliteral}{        @param seperator seperator used with the dataset}}
\DoxyCodeLine{00073 \textcolor{stringliteral}{        @param output output filename}}
\DoxyCodeLine{00074 \textcolor{stringliteral}{        @param output\_forced force overwrite}}
\DoxyCodeLine{00075 \textcolor{stringliteral}{        @param bulk marks bulk operation with directories}}
\DoxyCodeLine{00076 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{00077     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} (dataset \textcolor{keywordflow}{and} seperator \textcolor{keywordflow}{and} (output \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} output\_forced)):}
\DoxyCodeLine{00078         logging.pprint(f\textcolor{stringliteral}{"Training mode requires -\/d/-\/-\/dataset\{', -\/o/-\/-\/output' if output\_forced else''\} and -\/s/-\/-\/seperator parameters. Exiting."})}
\DoxyCodeLine{00079         exit(2)}
\DoxyCodeLine{00080 }
\DoxyCodeLine{00081     if(\textcolor{keywordflow}{not} bulk \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(dataset)):}
\DoxyCodeLine{00082         logging.pprint(f\textcolor{stringliteral}{"\{dataset\} doesn't exists. Check the file path, or working directory"})}
\DoxyCodeLine{00083         exit(3)}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085     if(output \textcolor{keywordflow}{and} os.path.isfile(output)):}
\DoxyCodeLine{00086         logging.pprint(f\textcolor{stringliteral}{"\{output\} exists and will be overwritten."},1 )}
\DoxyCodeLine{00087 }
\DoxyCodeLine{00088     if(seperator == \textcolor{stringliteral}{'\(\backslash\)\(\backslash\)t'}):}
\DoxyCodeLine{00089         logging.pprint(\textcolor{stringliteral}{"Escaping seperator."}, 3)}
\DoxyCodeLine{00090         seperator = \textcolor{stringliteral}{'\(\backslash\)t'}}
\DoxyCodeLine{00091     }
\DoxyCodeLine{00092     if(len(seperator)!=1):}
\DoxyCodeLine{00093         logging.pprint(f\textcolor{stringliteral}{'Delimiter must be a single character, and "\{seperator\}" is not accepted.'})}
\DoxyCodeLine{00094         exit(4)}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096     logging.pprint(f\textcolor{stringliteral}{'Starting training.'}, 3)}
\DoxyCodeLine{00097     model.Train(dataset,seperator, int(args.threads))}
\DoxyCodeLine{00098     logging.pprint(f\textcolor{stringliteral}{'Training completed.'}, 2)}
\DoxyCodeLine{00099 }
\DoxyCodeLine{00100     if(output):}
\DoxyCodeLine{00101         logging.pprint(f\textcolor{stringliteral}{'Exporting model to \{output\}'}, 2)}
\DoxyCodeLine{00102         model.Export(output)}
\DoxyCodeLine{00103     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00104         logging.pprint(f\textcolor{stringliteral}{'Model will not be exported.'}, 1)}
\DoxyCodeLine{00105 }
\DoxyCodeLine{\Hypertarget{markopy_8py_source_l00106}\mbox{\hyperlink{namespacemarkopy_a6b08ef2823dcc7c0bc8690e223ea9c80}{00106}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemarkopy_a6b08ef2823dcc7c0bc8690e223ea9c80}{cli\_generate}}(model : markopy.ModelMatrix, wordlist : str, bulk : bool=\textcolor{keyword}{False}):}
\DoxyCodeLine{00107     \textcolor{stringliteral}{""" Generate strings from the model}}
\DoxyCodeLine{00108 \textcolor{stringliteral}{        @param model: model instance}}
\DoxyCodeLine{00109 \textcolor{stringliteral}{        @param wordlist wordlist filename}}
\DoxyCodeLine{00110 \textcolor{stringliteral}{        @param bulk marks bulk operation with directories}}
\DoxyCodeLine{00111 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{00112     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} (wordlist \textcolor{keywordflow}{or} args.count):}
\DoxyCodeLine{00113         logging.pprint(\textcolor{stringliteral}{"Generation mode requires -\/w/-\/-\/wordlist and -\/n/-\/-\/count parameters. Exiting."})}
\DoxyCodeLine{00114         exit(2)}
\DoxyCodeLine{00115     }
\DoxyCodeLine{00116     if(bulk \textcolor{keywordflow}{and} os.path.isfile(wordlist)):}
\DoxyCodeLine{00117         logging.pprint(f\textcolor{stringliteral}{"\{wordlist\} exists and will be overwritten."}, 1)}
\DoxyCodeLine{00118     model.Generate(int(args.count), wordlist, int(args.min), int(args.max), int(args.threads))}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121 if(args.bulk):}
\DoxyCodeLine{00122     logging.pprint(f\textcolor{stringliteral}{"Bulk mode operation chosen."}, 4)}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124     \textcolor{keywordflow}{if} (args.mode.lower() == \textcolor{stringliteral}{"train"}):}
\DoxyCodeLine{00125         \textcolor{keywordflow}{if} (os.path.isdir(args.output) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(args.output)) \textcolor{keywordflow}{and} (os.path.isdir(args.dataset) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(args.dataset)):}
\DoxyCodeLine{00126             corpus\_list = os.listdir(args.dataset)}
\DoxyCodeLine{00127             \textcolor{keywordflow}{for} corpus \textcolor{keywordflow}{in} corpus\_list:}
\DoxyCodeLine{00128                 model = \mbox{\hyperlink{namespacemarkopy_a2339398e991abb1c095994eb07f12af6}{cli\_init}}(args.input)}
\DoxyCodeLine{00129                 logging.pprint(f\textcolor{stringliteral}{"Training \{args.input\} with \{corpus\}"}, 2)}
\DoxyCodeLine{00130                 output\_file\_name = corpus}
\DoxyCodeLine{00131                 model\_extension = \textcolor{stringliteral}{""}}
\DoxyCodeLine{00132                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"."} \textcolor{keywordflow}{in} args.input:}
\DoxyCodeLine{00133                     model\_extension = args.input.split(\textcolor{stringliteral}{"."})[-\/1]}
\DoxyCodeLine{00134                 \mbox{\hyperlink{namespacemarkopy_ab5b767749715ed49aacf40c4b839f3a9}{cli\_train}}(model, f\textcolor{stringliteral}{"\{args.dataset\}/\{corpus\}"}, args.seperator, f\textcolor{stringliteral}{"\{args.output\}/\{corpus\}.\{model\_extension\}"}, output\_forced=\textcolor{keyword}{True}, bulk=\textcolor{keyword}{True})}
\DoxyCodeLine{00135         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00136             logging.pprint(\textcolor{stringliteral}{"In bulk training, output and dataset should be a directory."})}
\DoxyCodeLine{00137             exit(1)}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139     \textcolor{keywordflow}{elif} (args.mode.lower() == \textcolor{stringliteral}{"generate"}):}
\DoxyCodeLine{00140         \textcolor{keywordflow}{if} (os.path.isdir(args.wordlist) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(args.wordlist)) \textcolor{keywordflow}{and} (os.path.isdir(args.input) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(args.input)):}
\DoxyCodeLine{00141             model\_list = os.listdir(args.input)}
\DoxyCodeLine{00142             print(model\_list)}
\DoxyCodeLine{00143             \textcolor{keywordflow}{for} input \textcolor{keywordflow}{in} model\_list:}
\DoxyCodeLine{00144                 logging.pprint(f\textcolor{stringliteral}{"Generating from \{args.input\}/\{input\} to \{args.wordlist\}/\{input\}.txt"}, 2)}
\DoxyCodeLine{00145                 }
\DoxyCodeLine{00146                 model = \mbox{\hyperlink{namespacemarkopy_a2339398e991abb1c095994eb07f12af6}{cli\_init}}(f\textcolor{stringliteral}{"\{args.input\}/\{input\}"})}
\DoxyCodeLine{00147                 model\_base = input}
\DoxyCodeLine{00148                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"."} \textcolor{keywordflow}{in} args.input:}
\DoxyCodeLine{00149                     model\_base = input.split(\textcolor{stringliteral}{"."})[1]}
\DoxyCodeLine{00150                 \mbox{\hyperlink{namespacemarkopy_a6b08ef2823dcc7c0bc8690e223ea9c80}{cli\_generate}}(model, f\textcolor{stringliteral}{"\{args.wordlist\}/\{model\_base\}.txt"}, bulk=\textcolor{keyword}{True})}
\DoxyCodeLine{00151         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00152             logging.pprint(\textcolor{stringliteral}{"In bulk generation, input and wordlist should be directory."})}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154 \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00155     model = \mbox{\hyperlink{namespacemarkopy_a2339398e991abb1c095994eb07f12af6}{cli\_init}}(args.input)}
\DoxyCodeLine{00156     \textcolor{keywordflow}{if} (args.mode.lower() == \textcolor{stringliteral}{"generate"}):}
\DoxyCodeLine{00157         \mbox{\hyperlink{namespacemarkopy_a6b08ef2823dcc7c0bc8690e223ea9c80}{cli\_generate}}(model, args.wordlist)}
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160     \textcolor{keywordflow}{elif} (args.mode.lower() == \textcolor{stringliteral}{"train"}):}
\DoxyCodeLine{00161         \mbox{\hyperlink{namespacemarkopy_ab5b767749715ed49aacf40c4b839f3a9}{cli\_train}}(model, args.dataset, args.seperator, args.output, output\_forced=\textcolor{keyword}{True})}
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163 }
\DoxyCodeLine{00164     elif(args.mode.lower() == \textcolor{stringliteral}{"combine"}):}
\DoxyCodeLine{00165         \mbox{\hyperlink{namespacemarkopy_ab5b767749715ed49aacf40c4b839f3a9}{cli\_train}}(model, args.dataset, args.seperator, args.output)}
\DoxyCodeLine{00166         \mbox{\hyperlink{namespacemarkopy_a6b08ef2823dcc7c0bc8690e223ea9c80}{cli\_generate}}(model, args.wordlist)}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168 }
\DoxyCodeLine{00169     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00170         logging.pprint(\textcolor{stringliteral}{"Invalid mode arguement given."})}
\DoxyCodeLine{00171         logging.pprint(\textcolor{stringliteral}{"Accepted modes: 'Generate', 'Train', 'Combine'"})}
\DoxyCodeLine{00172         exit(5)}

\end{DoxyCode}
